#!/bin/sh 

START=97
PIDFILE=/var/run/bismark-data-transmit.pid
DIRECTORIES="
active
bismark-experiments-manager
bismark-updater
censorship-performance
health
mac-analyzer
nazanin-traceroute
pakistan-censorship-testing
passive
passive-frequent
wifi-beacons
"
start() {
    for directory in $DIRECTORIES; do
        mkdir -p /tmp/bismark-uploads/$directory
    done

    if [ -f $PIDFILE ]; then
        echo "pidfile $PIDFILE already exists; bismark-data-transmit already running?"
        exit 1
    fi
    /sbin/start-stop-daemon -S \
        -x /usr/bin/bismark-data-transmit \
        -p $PIDFILE \
        -m -b -- $DATA_TRANSMIT_ARGUMENTS
}

stop() {
    [ -f $PIDFILE ] && {
        start-stop-daemon -K -q -p $PIDFILE -s TERM
        rm -f $PIDFILE
    }
}

restart() {
    stop
    start
}


case "$1" in
  start|"")
        start
        ;;
  restart|reload|force-reload)
        echo "Error: argument '$1' not supported" >&2
	restart
        exit 3
        ;;
  stop)
        stop
        ;;
  status)
        #do_status
        exit $?
        ;;
  *)   
        echo "Usage: bismark-data-transmit [start|stop|restart]" >&2
        exit 3
        ;;
esac
