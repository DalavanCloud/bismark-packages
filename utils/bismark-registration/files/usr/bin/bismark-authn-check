#!/bin/sh

# Turn off nodogsplash captive portal if valid authentication token exists.

. /etc/bismark/bismark.conf

if [ ! $REGISTRATION_MAX_SPLAY ]; then
	REGISTRATION_MAX_SPLAY=60
fi

if [ -f /etc/bismark/authn ]; then
	/etc/init.d/nodogsplash stop
else
	# No token
	url=$(awk '$1 == "GatewayName" { print $2 }' /etc/nodogsplash/nodogsplash.conf)
	if curl -f -m 600 -o /dev/null $url; then
		/etc/init.d/nodogsplash restart
	else
		/etc/init.d/nodogsplash stop
	fi
fi
